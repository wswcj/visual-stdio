#include <stdio.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <sys/mman.h>
#include <unistd.h>


int* p = NULL;

/*16x16*/ //保存了字的轮廓 模
unsigned char word[1][32] = { {0x20,0x00,0x3E,0x7C,0x48,0x44,0x08,0x44,0xFF,0x44,0x14,0x44,0x22,0x7C,0x40,0x00,
0x1F,0xF0,0x10,0x10,0x10,0x10,0x1F,0xF0,0x10,0x10,0x10,0x10,0x1F,0xF0,0x10,0x10} };

/*16x20*/ //0-9的模
unsigned char numword[10][40] = {
/*--  文字:  0  --*/
/*--  宋体15;  此字体下对应的点阵为：宽x高=10x20   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x20  --*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x3F,0x00,0x3F,0x00,0x73,0x80,0x73,0x80,0xE1,0xC0,
0xE1,0xC0,0xE1,0xC0,0xE1,0xC0,0xE1,0xC0,0xE1,0xC0,0x73,0x80,0x73,0x80,0x3F,0x00,
0x3F,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

/*--  文字:  1  --*/
/*--  宋体15;  此字体下对应的点阵为：宽x高=10x20   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x20  --*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x0C,0x00,0x7C,0x00,0x3C,0x00,0x0C,0x00,0x0C,0x00,
0x0C,0x00,0x0C,0x00,0x0C,0x00,0x0C,0x00,0x0C,0x00,0x0C,0x00,0x0C,0x00,0x1E,0x00,
0x7F,0x80,0x00,0x00,0x00,0x00,0x00,0x00},

/*--  文字:  2  --*/
/*--  宋体15;  此字体下对应的点阵为：宽x高=10x20   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x20  --*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x3F,0x00,0x77,0x80,0x63,0x80,0x71,0x80,0x71,0x80,
0x03,0x80,0x03,0x00,0x06,0x00,0x0C,0x00,0x18,0x00,0x30,0x80,0x71,0x80,0xFF,0x80,
0xFF,0x80,0x00,0x00,0x00,0x00,0x00,0x00},

/*--  文字:  3  --*/
/*--  宋体15;  此字体下对应的点阵为：宽x高=10x20   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x20  --*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x3F,0x00,0x77,0x00,0x63,0x80,0x73,0x80,0x03,0x80,
0x07,0x00,0x1E,0x00,0x07,0x80,0x03,0x80,0x01,0x80,0x71,0x80,0xF3,0x80,0x77,0x80,
0x3F,0x00,0x00,0x00,0x00,0x00,0x00,0x00},


/*--  文字:  4  --*/
/*--  宋体15;  此字体下对应的点阵为：宽x高=10x20   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x20  --*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x00,0x07,0x00,0x0F,0x00,0x1F,0x00,0x1F,0x00,
0x3F,0x00,0x37,0x00,0x67,0x00,0xC7,0x00,0xFF,0xC0,0x07,0x00,0x07,0x00,0x07,0x00,
0x1F,0xC0,0x00,0x00,0x00,0x00,0x00,0x00},

/*--  文字:  5  --*/
/*--  宋体15;  此字体下对应的点阵为：宽x高=10x20   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x20  --*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0x80,0x7F,0x00,0x60,0x00,0x60,0x00,0x60,0x00,
0x7F,0x00,0x77,0x80,0x63,0x80,0x01,0x80,0x21,0x80,0x71,0x80,0xE3,0x80,0x77,0x80,
0x3F,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

/*--  文字:  6  --*/
/*--  宋体15;  此字体下对应的点阵为：宽x高=10x20   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x20  --*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x1F,0x00,0x3B,0x80,0x73,0x80,0x70,0x00,0xE0,0x00,
0xFF,0x00,0xFB,0x80,0xF1,0x80,0xE1,0xC0,0xE1,0xC0,0xE1,0xC0,0x71,0x80,0x7B,0x80,
0x3F,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

/*--  文字:  7  --*/
/*--  宋体15;  此字体下对应的点阵为：宽x高=10x20   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x20  --*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0xC0,0x7F,0x80,0x63,0x00,0x43,0x00,0x07,0x00,
0x06,0x00,0x0E,0x00,0x0C,0x00,0x0C,0x00,0x1C,0x00,0x1C,0x00,0x1C,0x00,0x1C,0x00,
0x1C,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

/*--  文字:  8  --*/
/*--  宋体15;  此字体下对应的点阵为：宽x高=10x20   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x20  --*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x3F,0x00,0x73,0x80,0x61,0x80,0xE1,0x80,0x71,0x80,
0x7B,0x80,0x3E,0x00,0x7F,0x00,0x63,0x80,0xE1,0x80,0xE1,0xC0,0xE1,0x80,0x73,0x80,
0x3F,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

/*--  文字:  9  --*/
/*--  宋体15;  此字体下对应的点阵为：宽x高=10x20   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x20  --*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x3F,0x00,0x77,0x00,0xE3,0x80,0xE3,0x80,0xE1,0xC0,
0xE1,0xC0,0xE3,0xC0,0x77,0xC0,0x3F,0x80,0x03,0x80,0x03,0x80,0x73,0x80,0x77,0x00,
0x7E,0x00,0x00,0x00,0x00,0x00,0x00,0x00}

};



void draw_point(int x, int y, int color)
{
	if (x >= 0 && x < 800 && y >= 0 && y < 480)
	{
		*(p + y * 800 + x) = color;
	}

}

void show_word(unsigned char* word1, int totalbyte, int wordwide, int wordcolor, int start_x, int start_y)
{
	//3.显示字 
	int num = 0;
	int x, y;
	int i, j;
	for (i = 0; i < totalbyte; i++)  //字节数
	{
		for (j = 7; j >= 0; j--) //每个字节8bit
		{
			if (word1[i] & (1 << j))   // 1 << 7 -> 1000 0000 刷一个与底色不同的颜色
			{
				x = num % wordwide;   //x = (i % 2) * 8 + (7 -j);
				y = num / wordwide;   //y = i / 2;
				draw_point(start_x + x, start_y + y, wordcolor);

			}
			num++;
		}
	}

}

void show_num(int a, int start_x, int start_y)
{
	if (a >= 0 && a < 10)  //只有个位 5
	{
		show_word(numword[a], sizeof(numword[a]), 16, 0x00FF0000, start_x, start_y);  //0
	}
	if (a >= 10 && a < 100) //有个位 和十位 25
	{
		show_word(numword[a / 10], sizeof(numword[a / 10]), 16, 0x00FF0000, start_x, start_y); //显示十位
		show_word(numword[a % 10], sizeof(numword[a % 10]), 16, 0x00FF0000, start_x + 16, start_y);//显示十位
	}
	if (a >= 100 && a < 1000)//有个位 十位 和百位 125 
	{
		show_word(numword[a / 100], sizeof(numword[a / 100]), 16, 0x00FF0000, start_x, start_y); //显示百位
		show_word(numword[a % 100 / 10], sizeof(numword[a % 100 / 10]), 16, 0x00FF0000, start_x + 16, start_y);
		show_word(numword[a % 10], sizeof(numword[a % 10]), 16, 0x00FF0000, start_x + 32, start_y);
	}
	//...
}

int main()
{
	//1.打开帧缓冲设备文件
	int lcd_fd = open("/dev/fb0", O_RDWR);
	if (lcd_fd < 0)
	{
		printf("open lcd_fd failed\n");
	}
	//2.映射
	p = mmap(NULL, 800 * 480 * 4, PROT_READ | PROT_WRITE, MAP_SHARED, lcd_fd, 0);
	if (p == MAP_FAILED)
	{
		printf("mmap failed\n");
	}

	//刷底色->白色
	int i, j;
	for (i = 0; i < 480; i++)
	{
		for (j = 0; j < 800; j++)
		{
			draw_point(j, i, 0x00FFFFFF);
		}
	}

	//显示数字字 
	//show_word(numword[0], sizeof(numword[0]), 16, 0x00FF0000, 0, 0);  //0
	//show_word(numword[1], sizeof(numword[1]), 16, 0x00FF0000, 16, 0); //1
	//show_word(numword[2], sizeof(numword[2]), 16, 0x00FF0000, 32, 0); //2
	//show_word(numword[3], sizeof(numword[3]), 16, 0x00FF0000, 48, 0); //3
	for (int k = 0; k < 10; ++k) {
		show_word(numword[k], sizeof(numword[k]), 16, 0x00FF0000, k * 16, 0);
	}
	//...
	int a;
	scanf("%d", &a);
	show_num(a, 100, 100);


	//解除映射
	int c = munmap(p, 800 * 480 * 4);
	if (c == -1)
	{
		printf("munmap failed\n");
	}
	//关闭文件
	c = close(lcd_fd);
	if (c == -1)
	{
		printf("close lcd_fd failed\n");
	}



	return 0;
}